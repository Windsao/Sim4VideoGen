==================================================
Wandb initialized successfully!
  Project: Sim4Videos
  Run name: lora
[34m[1mwandb[0m: [33mWARNING[0m The get_url method is deprecated and will be removed in a future release. Please use `run.url` instead.
  Run URL: https://wandb.ai/magicslabnorthwestern/Sim4Videos/runs/58vw8m8d
  Log every 10 steps
==================================================
Epoch 1/5:   1%| | 3/525 [01:15<3:38:36, 25.13s/it, loss=1.2675, noise=0.0409, motion=10.9375, depth=1.0547
[WARNING] NaN/Inf in target_depth, clamping...
[WARNING] NaN/Inf in target_depth, clamping...
Traceback (most recent call last):
  File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 1366, in <module>
    launch_training_task_with_wandb(dataset, model, model_logger, args=args)
  File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 1152, in launch_training_task_with_wandb
    result = unwrapped_model(data, return_loss_dict=True)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 518, in forward
    inputs = self.forward_preprocess(data)
  File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 430, in forward_preprocess
    inputs_shared, inputs_posi, inputs_nega = self.pipe.unit_runner(
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/utils/__init__.py", line 273, in __call__
    processor_outputs = unit.process(pipe, **processor_inputs)
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/pipelines/wan_video_new.py", line 558, in process
    input_latents = pipe.vae.encode(input_video, device=pipe.device, tiled=tiled, tile_size=tile_size, tile_stride=tile_stride).to(dtype=pipe.torch_dtype, device=pipe.device)
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 1228, in encode
    hidden_state = self.single_encode(video, device)
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 1208, in single_encode
    x = self.model.encode(video, self.scale)
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 997, in encode
    out_ = self.encoder(x[:, :, 1 + 4 * (i - 1):1 + 4 * i, :, :],
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 589, in forward
    x = layer(x, feat_cache, feat_idx)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 296, in forward
    x = layer(x, feat_cache[idx])
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 52, in forward
    return super().forward(x)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 717, in forward
    return self._conv_forward(input, self.weight, self.bias)
  File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 712, in _conv_forward
    return F.conv3d(
KeyboardInterrupt
[rank0]: Traceback (most recent call last):
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 1366, in <module>
[rank0]:     launch_training_task_with_wandb(dataset, model, model_logger, args=args)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 1152, in launch_training_task_with_wandb
[rank0]:     result = unwrapped_model(data, return_loss_dict=True)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 518, in forward
[rank0]:     inputs = self.forward_preprocess(data)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/train_wan_with_motion.py", line 430, in forward_preprocess
[rank0]:     inputs_shared, inputs_posi, inputs_nega = self.pipe.unit_runner(
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/utils/__init__.py", line 273, in __call__
[rank0]:     processor_outputs = unit.process(pipe, **processor_inputs)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/pipelines/wan_video_new.py", line 558, in process
[rank0]:     input_latents = pipe.vae.encode(input_video, device=pipe.device, tiled=tiled, tile_size=tile_size, tile_stride=tile_stride).to(dtype=pipe.torch_dtype, device=pipe.device)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 1228, in encode
[rank0]:     hidden_state = self.single_encode(video, device)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 1208, in single_encode
[rank0]:     x = self.model.encode(video, self.scale)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 997, in encode
[rank0]:     out_ = self.encoder(x[:, :, 1 + 4 * (i - 1):1 + 4 * i, :, :],
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 589, in forward
[rank0]:     x = layer(x, feat_cache, feat_idx)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 296, in forward
[rank0]:     x = layer(x, feat_cache[idx])
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1773, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1784, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/home/mzh1800/DiffSynth-Studio/diffsynth/models/wan_video_vae.py", line 52, in forward
[rank0]:     return super().forward(x)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 717, in forward
[rank0]:     return self._conv_forward(input, self.weight, self.bias)
[rank0]:   File "/nyx-storage1/hanliu/miniconda3/envs/diffsyn/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 712, in _conv_forward
[rank0]:     return F.conv3d(
[rank0]: KeyboardInterrupt
